<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta charset="UTF-8">

  <!-- Enable responsiveness on mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      ThothBackup - Stage 0 &middot; Bit of A Byte
    
  </title>

  
  <!-- canonical link -->
  <link rel="canonical" href="/projects/thothbackup/stage-0/">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Dosis">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">

  <!-- Icons -->
  <!-- <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png"> -->
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Google Analytics -->
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-130197091-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>My name is Natalie and I spend most of my time taking apart things I have no business taking apart.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/projects/">Projects</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/site/">Site Information</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/tags/">Tags</a>
        
      
    

    <a class="sidebar-nav-item" href="https://github.com/zyradyl/zyradyl.github.io">Currently v0.6.0</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://creativecommons.org/publicdomain/zero/1.0/">
        Ø 2018 - No Rights Reserved.
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            
                <small><a href="http://127.0.0.1">$USER</a>@<a href="/" title="Home">bit-of-a-byte</a>
             ~ $ cat /var/log/pages/thothbackup---stage-0.md</small>
              
            </h3>
        </div>
      </div>

      <div class="container content">
        <div class="page">
  <h1 class="page-title">ThothBackup - Stage 0</h1>
  <h2 id="environment--hardware-setup">Environment &amp; Hardware Setup</h2>

<h3 id="project-contents">Project Contents</h3>
<ul>
  <li>Stage 0 - Environment &amp; Hardware Setup</li>
  <li><a href="/projects/thothbackup/stage-1/">Stage 1 - Server Configuration &amp; Hardening</a></li>
  <li><a href="/projects/thothbackup/stage-2/">Stage 2 - Client to Server Syncronization</a></li>
  <li><a href="/projects/thothbackup/stage-3/">Stage 3 - Establishment of Local Repository</a></li>
  <li><a href="/projects/thothbackup/stage-4/">Stage 4 - Preparation for Remote Syncronization</a></li>
  <li><a href="/projects/thothbackup/stage-5/">Stage 5 - Remote Syncronization</a></li>
  <li><a href="/projects/thothbackup/stage-6/">Stage 6 - Scheduled Data Integrity Verification</a></li>
  <li><a href="/projects/thothbackup/stage-7/">Stage 7 - Restore Capabilities</a></li>
  <li><a href="/projects/thothbackup/stage-8/">Stage 8 - Conclusions</a></li>
  <li><a href="https://github.com/zyradyl/ThothBackup">GitHub Repository</a></li>
</ul>

<h3 id="introduction">Introduction</h3>
<p>This section will be divided into several parts. In the first part, we will talk
about the environment that the server exists in. This will handle things like
power and networking, basically everything that exists outside the server. Next,
we will take a look at the server itself, and any changes that have been made to
it. We will then discuss the currently used storage devices. Finally, we will
talk about things that could be improved with this setup, and any potential
changes that could be made to increase security.</p>

<h3 id="environment">Environment</h3>

<h4 id="location">Location</h4>
<p>Everything lives in a TV-stand-esque cabinet inside the living room of our
800ft^2 apartment. The Mac Mini and the storage devices sit on a little shelf
above the cabinet portion so they have ample access to fresh air, and the
other devices sit inside the closed portion of the cabinet. The cabinet is
actually right next to my bed, so in the event of a power outage the beep would
theoretically be loud enough to wake me up.</p>

<h4 id="networking">Networking</h4>
<p>The Mac Mini is connected to an <a href="https://www.ubnt.com/edgemax/edgerouter-lite/">Ubiquiti EdgeRouter Lite</a> via a
<a href="https://www.netgear.com/business/products/switches/unmanaged/GS108.aspx">Netgear GS180v4 Unmanaged Switch</a>. The WAN connection to the router is a
100mbps symmetrical fiber connection that will eventually be upgraded to a 1Gbps
symmetrical fiber connection. The fiber is coverted to ethernet via a GPON to
ethernet conversion jack. Cabling from each point is provided by
<a href="https://www.amazon.com/dp/B07BYBCXZ8/ref=cm_sw_r_cp_ep_dp_QMoaCbJKKX17D">LinkUp Fluke Certified Cat7 S/FTP Cables</a>. While I don’t actually think
these cables are any better than any other cable, I like the design of them and
the way they feel. Besides, having an included Fluke report with each cable
certainly can’t hurt.</p>

<h4 id="power">Power</h4>
<p>The Mac Mini is connected to a small battery backup. The battery wouldn’t be
able to power it for the entire duration of the outage, but the theory is that
it would allow time to get everything successfully and safely shut down.</p>

<p>Additionally, the router that the mini connects to the internet through is on
the same battery. This is for the same reasons, as the router is an EdgeRouter
and sudden shut off could potentially cause corruption to the boot image.</p>

<p>Finally, any and all storage devices that the server uses are connected to the
battery as well. This ensures that any writes will be able to complete
successfully.</p>

<p>The battery is connected to mains power a short distance away.</p>

<h3 id="server">Server</h3>

<h4 id="base-model">Base Model</h4>
<p>The Mac Mini that is being used is an <a href="https://everymac.com/systems/apple/mac_mini/specs/mac-mini-core-2-duo-2.0-specs.html">A1176 Mac Mini</a> with an Intel Core 2
Duo processor. You can see the original specifications of the Mac by following
the link above. The Mac was purchased by me second hand for about $100 and
some change and came with a whole host of accessories that are not in use at
this time. Unfortunately, this Mac was one of the last ones before Apple
switched to using a 64-bit EFI for the system firmware. You will read more about
why that is unfortunate during stage one.</p>

<h4 id="upgrades--modifications">Upgrades &amp; Modifications</h4>
<p><img src="/images/posts/mac-mini.jpeg" alt="Modified MacMini2,1" /></p>

<p>The Mac has been extensively modified. To begin with, many of the components
inside have been removed. You can see from the above picture some of the
modifications. The sound card, bluetooth card, wireless card, any errant wires,
anything that is non-essential was stripped out and thrown away. The server has
no ability to communicate wirelessly at this point. The only thing that remains
is the IR sensor, but that is strange to me because I removed the actual
receiver.</p>

<p>The CPU heatsink was removed, very carefully, and the thermal pad was replaced
with Artic Silver thermal compound. The entire system was completely
disassembled and meticulously cleaned with 99% Isopropyl alcohol. In addition,
the fan was replaced with a new OEM fan to ensure longer survival.</p>

<p>The hard drive of the Mac was originally a 5400rpm Hitachi 160GB SATA drive
that was white labeled for Apple specifically. This has been replaced with an
<a href="https://www.owcdigital.com/products/electra-3g-ssd">OWC Mercury Electra 3G 240GB SSD</a> and the RAM was upgraded with a matched
set of <a href="https://eshop.macsales.com/item/OWC/5300DDR2S4GP/">OWC PC5300 DDR2 2GB</a> memory modules. While it is likely I could
have got the RAM and SSD from pretty much anywhere, I like OWC and their prices,
for these upgrades at least, were reasonable.</p>

<h4 id="peripherals">Peripherals</h4>
<p>The only peripheral worth listing in this section is a <a href="http://madebymitchell.com/edid/">DVI EDID Dummy Plug</a>
which simulates a 1920x1200 monitor being attached to the Mac. Normally I would
not bother with an EDID Dummy Plug because the server won’t need to render any
graphics for this use case, but in their infinite wisdom Apple decided that this
model of Mini should <em>only</em> be able to function as a Personal Computer, and the
damn thing won’t load past the EFI unless it detects a monitor.</p>

<p>Other than power, networking, and storage, this is the only peripheral attached
to the Mini.</p>

<h4 id="future-plans">Future Plans</h4>
<p>It is possible more upgrades may be done on the Mini in time. The most
significant issue preventing any further upgrades is that I cannot seem to get
the damn computer to detect a USB drive for a boot option. Should I manage to
get it to the point that the system will boot from USB, there are a few
additional updates I would make:</p>

<ul>
  <li>Replace the Internal DVD-ROM Drive with a PATA to SATA converter from iFixit</li>
  <li>Install a 1TB Western Digital RED data drive</li>
  <li>Replace the top cover of the mini with the cover from an A1278 Mini Server</li>
  <li><em>Possibly</em> max out the CPU to an Intel Core2 T7600.
    <ul>
      <li>Doing literally anything involving the CPU is a tedious endeavor because
Apple used one way plastic plugs to mount the heatsink. I was lucky when
I was changing the thermal compound, and I do not think I will get lucky
again. This means that I would need to use nylon bolts to remount the HS
and that solution isn’t particularly elegant to me.</li>
    </ul>
  </li>
</ul>

<h3 id="storage">Storage</h3>

<h4 id="drive">Drive</h4>
<p>Right now storage is provided by a single external drive. The drive is a
<a href="https://www.g-technology.com/products/desktop/g-drive-usb-c#0G05666">G-Drive 4TB USB-C</a> external drive, which internally is just a white labeled
Western Digital 4TB RED drive. I bought the USB-C model even though the Mini
only has USB 2.0 Ports because based on some preliminary research, USB-3 drives
on USB-2 ports are still faster than USB-2 drives on USB-2 ports. Additionally,
should I ever upgrade the server, the drive will just get faster instead of
slower. Additionally, the USB-C port is just more elegant than the way they
added USB3 onto existing USB2-B connections. I just like the look of them more.
I understand that that is trivial, but that’s just the way it is.</p>

<h4 id="cable">Cable</h4>
<p>While I am sure that the standard cable would have been more than sufficient, I
have this weird thing about using manufacturer provided cables, even from a
reputable manufacturer. To this end, I replaced the original cable with an
<a href="https://www.anker.com/products/variant/powerline-usb-c-to-usb-a-double-braided-nylon-fast-charging-cable/B8266092">Anker PowerLine+ USBC to USBA</a>. It’s red, it’s pretty, and it has a pretty
decent warranty on it.</p>

<h3 id="improvements">Improvements</h3>
<p>Honestly the biggest improvement that could be made would be swapping the server
for something much more powerful. Right now I am looking at second hand Mac Pro
towers, with Xeon processors and ECC Ram. Once I purchase one, it is likely that
I would max it out and do some internal modifications to it before switching it
out with the current Mini.</p>

<p>Beyond that obvious one though, other upgrades could be made as noted in the
server section. The most realistic one that could happen relatively soon is the
addition of a second external drive. This drive would allow for dedicated drives
for each part of the data process, or more likely, mirrored drives to increase
performance. That being said, the USB-2 connection isn’t actually the bottleneck
in the system at this time. That discussion, however, will take place during
Stage One.</p>

<h3 id="security-considerations">Security Considerations</h3>
<p>The biggest thing that could be done with respect to increasing security is the
addition of a Hardware Security Module. Currently I am considering implementing
the [NitroKey HSM][21] due to its reasonable price, open nature, and multiple
interesting features. All of this is secondary, however, to the far more likely
progression of upgrading the entire server with a new one. Once that is done,
then it is reasonable that we may focus on security.</p>

<p>That said, it is possible that I will be unable to find a reasonable deal on
secondhand towers, and in that case I may, instead, choose to continue working
with this little Mini.</p>

<h3 id="conclusion">Conclusion</h3>
<p>This concludes the first stage, or rather, the zeroth stage, of the backup
project. We itemized the various components that form the foundation for the
software aspects of this project, iterated over potential improvements, and
listed security features that could be implemented at a later date. After this,
we move on to <a href="/projects/thothbackup/stage-1/">Stage 1</a> where we talk about the chosen operating system and
how to make it more secure for it’s use as a hosting environment.</p>


</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
