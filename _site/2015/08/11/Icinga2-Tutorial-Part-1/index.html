<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta charset="UTF-8">

  <!-- Enable responsiveness on mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Icinga2 Tutorial: Part 1 - Installation and Configuration &middot; Bit of A Byte
    
  </title>

  
  <!-- canonical link -->
  <link rel="canonical" href="/2015/08/11/Icinga2-Tutorial-Part-1/">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Dosis">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">

  <!-- Icons -->
  <!-- <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png"> -->
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Google Analytics -->
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-130197091-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>My name is Natalie and I spend most of my time taking apart things I have no business taking apart.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/projects/">Projects</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/site/">Site Information</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/tags/">Tags</a>
        
      
    

    <a class="sidebar-nav-item" href="https://github.com/zyradyl/zyradyl.github.io">Currently v0.6.0</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://creativecommons.org/publicdomain/zero/1.0/">
        Ø 2018 - No Rights Reserved.
      </a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            
                 <small><a href="http://127.0.0.1">$USER</a>@<a href="/" title="Home">bit-of-a-byte</a>
              ~ $ cat /var/log/icinga2-tutorial-part-1-installation-and-configuration.log</small>
              
            </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Icinga2 Tutorial: Part 1 - Installation and Configuration</h1>
  <span class="post-date">11 Aug 2015</span>
  <ul>
  <li><a href="/2015/08/10/Icinga2-Tutorial-Part-0/">Icinga2 Tutorial: Part 0 - Network Monitoring for the Masses</a></li>
  <li><a href="/2015/08/12/Icinga2-Tutorial-Part-2/">Icinga2 Tutorial: Part 2 - Agent-less Checks</a></li>
  <li><a href="/2015/08/17/Icinga2-Tutorial-Part-3/">Icinga2 Tutorial: Part 3 - Agent-Based Checks</a></li>
  <li><a href="/2015/09/07/Icinga2-Tutorial-Part-4/">Icinga2 Tutorial: Part 4 - Extending Checks to SNMP</a></li>
</ul>

<p><strong>EDIT (2018/12/09):</strong> <em>These guides haven’t been updated since 2015. It is
possible that there are dead links, or that the configuration syntax has changed
dramatically. These posts are also some of the most popular on my blog. I plan
to do a new guide eventually, but for right now please take the following
entries with a grain of salt.</em></p>

<h2 id="introduction">Introduction</h2>
<p>I wanted to get this out fairly quickly, because I just actually did this, and
while the default <a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/getting-started#setting-up-icinga2">Icinga2 tutorial</a> is pretty good, it is lacking in some
areas, and since everything is fresh in my mind I wanted to go ahead and draft
this up.</p>

<p>It is worth noting that in this post I will assume you are root. You can get to
root as a sustained environment by using <code class="highlighter-rouge">sudo -s</code>.</p>

<p>I do not condone this for day to day usage, it is <strong>bloody dangerous</strong>.</p>

<p>So, let’s get started. Sudo to root.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zyradyl@captor ~ $ sudo -s
[sudo] password for zyradyl:
captor zyradyl #
</code></pre></div></div>

<h3 id="installing-icinga2">Installing Icinga2</h3>
<p>This assumes you are root, and on a Debian based system. For other
systems, you can find <a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/getting-started#setting-up-icinga2">additional documentation here</a>. Note that I follow
that documentation very closely except for a few small notes, so it should be
easy to adjust this tutorial for your needs.</p>

<h4 id="adding-repositories">Adding Repositories</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>captor zyradyl # wget -O - http://debmon.org/debmon/repo.key 2&gt;/dev/null | apt-key add -
captor zyradyl # echo deb http://debmon.org/debmon debmon-jessie main &gt;/etc/apt/sources.list.d/debmon.list
captor zyradyl # apt-get update
</code></pre></div></div>

<p>The first command downloads the cryptographic key for the debmon
repository and hands it over to apt. Apt then installs that key, which allows
you to verify that you are using packages signed off by and validated by that
repository. The second command is then echoing the debmon main repository into
your apt-sources, so that the software available there is added to your
system’s list, which allows you to install with just a command. The third
command tells your system to update its internal package list to incorporate
the changes. After that we can go ahead and install.</p>

<h4 id="installation">Installation</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>captor zyradyl # apt-get install icinga2 monitoring-plugins
</code></pre></div></div>

<p>This will install both <a href="https://www.icinga.org/icinga/icinga-2/">icinga2</a> and the nagios monitoring plugins that are
compatible. This gives you a very good base. Start the program through the
service command, and then set it to start on boot with <code class="highlighter-rouge">update-rc.d</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>captor zyradyl # service icinga2 start
captor zyradyl # update-rc.d icinga2 enable
</code></pre></div></div>

<p>Tada! You now have a data aggregator/network monitor setup! However, we
want a nice way to get information from our monitoring host, so now we need to
install the web front end.</p>

<h2 id="installing-icingaweb2">Installing IcingaWeb2</h2>
<p>Let’s start with all the essentials.</p>

<h3 id="package-installation">Package Installation</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>captor zyradyl # apt-get install postgresql icinga2-ido-pgsql apache2 php5-ldap php5-imagick php5-pgsql php5-intl icingaweb2 icingaweb2-module-doc icingaweb2-module-monitoring icingaweb2-module-setup
</code></pre></div></div>

<p>This is a big one, so if you are living on about a meg down, prepare to settle
in for a bit. In order, this will install the PostgreSQL database, the
<a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/advanced-topics#db-ido">Icinga2 database connector</a>, the apache2 web server, the ldap php5 module,
the imagemagick module for php5, the postgresql php5 module, the intl php5
module, the IcingaWeb2 core, the IcingaWeb2 documentation module, the IcingaWeb2
monitoring module, and the IcingaWeb2 setup module. Note that on debian systems,
it will prompt you to allow it to setup the database. I <strong>strongly</strong> recommend
you say NO to that, and do it manually.</p>

<p>Once this completes, get everything running and added to the default runlevel.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>captor zyradyl # service postgresql start
captor zyradyl # update-rc.d postgresql enable
captor zyradyl # service apache2 start
captor zyradyl # update-rc.d apache2 enable
</code></pre></div></div>

<h3 id="database-configuration">Database Configuration</h3>
<p>Now we need to make that database. The first command defines a new user named
“<em>icinga</em>” with a password of the same name. The second command then creates a
database named <strong>icinga</strong>, and grants ownership to the user <strong>icinga</strong>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>captor zyradyl # cd /tmp
captor tmp # sudo -u postgres psql -c "CREATE ROLE icinga WITH LOGIN PASSWORD 'icinga';"
captor tmp # sudo -u postgres createdb -O icinga -E UTF8 icinga
</code></pre></div></div>

<p>Once this is done, edit the file <code class="highlighter-rouge">pg_hba.conf</code>. This file controls the way
that hosts can authenticate with your database. We want to make sure that
icinga can utilize standard password login, or md5.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>captor tmp # vim /etc/postgresql/9.4/main/pg_hba.conf

    # icinga
    local    icinga    icinga                    md5
    host     icinga    icinga    127.0.0.1/32    md5
    host     icinga    icinga    ::1/128         md5
</code></pre></div></div>

<p>Save, and then restart the database to activate the changes. Once restarted,
we can import the <a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/getting-started#configuring-db-ido-postgresql">IDO SQL</a> schema into Postgres. The export line pushes
the password into the environment, thus allowing us to avoid having to type it
in.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>captor tmp # service postgresql restart
captor tmp # export PGPASSWORD=icinga
captor tmp # psql -U icinga -d icinga &lt; /usr/share/icinga2-ido-pgsql/schema/pgsql.sql
</code></pre></div></div>

<p>Now we need to go ahead and enable the features that icinga2 will use.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>captor tmp # icinga2 feature enable command
captor tmp # icinga2 feature enable ido-pgsql
captor tmp # icinga2 feature enable livestatus
captor tmp # icinga2 feature enable statusdata
captor tmp # service icinga2 restart
</code></pre></div></div>

<p>The final line restarts icinga2, which is the final step to enable these
modules. Now, we need to update the configuration file for ido-pgsql to connect
it to our database that we manually set up above.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>captor tmp # vim /etc/icinga2/features-enabled/ido-pgsql.conf
</code></pre></div></div>

<p>Fill in the needed information as appropriate. Now you need to update the
<a href="http://php.net/manual/en/timezones.php">date.timezone</a> variable in the php configuration, which can be found
below.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>captor tmp # vim /etc/php5/apache2/php.ini
</code></pre></div></div>

<p>As an example, mine is set to “<em>America/Detroit</em>”. Now, to allow the web server
to pass commands to icinga2, we need to modify the <strong>www-data</strong> user into the
proper group. On Debian, this is the nagios group.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>captor tmp # usermod -a -G nagios www-data
</code></pre></div></div>

<p>Finally, we need to use icingacli to generate our authentication token to run
initial setup.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>captor tmp # icingacli setup token create
captor tmp # icingacli setup token show
</code></pre></div></div>

<p>The second command will show you the token should you forget it. Now open a
browser and navigate to the localhost web page. and follow along.</p>

<p>Something to note is that you should never select skip verification until you
have checked all your log files in <code class="highlighter-rouge">/var/log</code>, and you are certain everything
is correct, and the programming is just being buggy. Also keep in mind that
postgres uses <strong>port 5432</strong>, not the default port of 3306. Finally, you should
set a password for the postgres’ database superuser, because you are
going to need to use the superuser’s account credentials in the setup program
to create the database.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>captor tmp # sudo -u postgres psql postgres

# \password postgres
Enter Password:
</code></pre></div></div>

<p>This will change the password, and with that, we can end this part. Next up
will be configuring hosts both capable of using the icinga2 protocol, and
configuring icinga to speak to simple hosts.</p>


</div>

<div class="related">
<h2>Related Posts</h2>



  
    
    
    
    <ul class="related-posts">
    
  
    
    
    
    <ul class="related-posts">
    
  
    
    
    
    <ul class="related-posts">
    
  
    
    
    
    <ul class="related-posts">
    
  
    
    
    
    <ul class="related-posts">
    
  
    
    
    
    <ul class="related-posts">
    
  
    
    
    
    <ul class="related-posts">
    
  
    
    
    
    <ul class="related-posts">
    
  
    
    
    
    <ul class="related-posts">
    
  
    
    
    
    <ul class="related-posts">
    
  
    
    
    
    <ul class="related-posts">
    
  
    
    
    
    <ul class="related-posts">
    
  
    
    
    
    <ul class="related-posts">
    
    <li>
      <h3>
        <a href="/2015/09/07/Icinga2-Tutorial-Part-4/">
          Icinga2 Tutorial Part 4 - Expanding Checks to SNMP <!--<span class="label label-default">Icinga2</span>-->  <!--<span class="label label-default">IcingaWeb2</span>--> 
          <small>
            07 Sep 2015
          </small>
        </a>
      </h3>
    </li>
      
      
    
  
    
    
    
    <ul class="related-posts">
    
  
    
    
    
    <ul class="related-posts">
    
  
    
    
    
    <ul class="related-posts">
    
    <li>
      <h3>
        <a href="/2015/08/17/Icinga2-Tutorial-Part-3/">
          Icinga2 Tutorial: Part 3 - Agent-Based Checks <!--<span class="label label-default">Icinga2</span>-->  <!--<span class="label label-default">IcingaWeb2</span>--> 
          <small>
            17 Aug 2015
          </small>
        </a>
      </h3>
    </li>
      
      
    
  
    
    
    
    <ul class="related-posts">
    
  
    
    
    
    <ul class="related-posts">
    
    <li>
      <h3>
        <a href="/2015/08/12/Icinga2-Tutorial-Part-2/">
          Icinga2 Tutorial: Part 2 - Agent-Less Checks <!--<span class="label label-default">Icinga2</span>-->  <!--<span class="label label-default">IcingaWeb2</span>--> 
          <small>
            12 Aug 2015
          </small>
        </a>
      </h3>
    </li>
      
      
        
  </ul>
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
